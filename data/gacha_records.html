<html>
    <head>
        <script>
            // Debug entry
            // record = [
            //     {"time": 10000341, "item": 1001}, 
            //     {"time": 10000342, "item": 1002}, 
            //     {"time": 10000343, "item": 1003}, 
            // ];
            // maxPage = 5;

            // in production environment
            record = {{REPLACE_RECORD}};
            maxPage = {{REPLACE_MAXPAGE}};

            // TODO: implement this mapper by yourself
            // I don't want to put real items' name here to avoid being DMCA'd
            mappings = {
                'zh-cn': {
                    200: "初行者推荐祈愿",
					201: "常驻祈愿池",
					300: "1.3 武器池",
					301: "1.4 武器池",
					302: "2.0 武器池",
					303: "2.3 武器池",
					304: "2.4 武器池1",
					305: "2.4 武器池2",
					306: "2.5 武器池",
					307: "2.6 武器池",
                    400: "1.0 温蒂",
                    401: "1.0 可莉",
					402: "1.1 达达利亚",
					403: "1.1 钟离",
					404: "1.2 阿贝多",
					405: "1.2 甘雨",
					406: "1.3 魈",
					407: "1.3 刻晴",
					408: "1.3 胡桃",
					409: "1.4 温蒂复刻",
					410: "1.4 达达利亚复刻",
					411: "1.5 钟离复刻",
					412: "1.5 优菈",
					413: "1.6 可莉复刻",
					414: "1.6 枫原万叶",
					415: "2.0 神里绫华",
					416: "2.0 宵宫",
					417: "2.1 雷电将军",
					418: "2.1 珊瑚宫心海",
					419: "2.2 达达利亚2次复刻",
					420: "2.2 胡桃复刻",
					421: "2.3 阿贝多复刻",
					422: "2.3 优菈复刻",
					423: "2.3 荒泷一斗",
					424: "2.4 申鹤",
					425: "2.4 甘雨复刻",
					426: "2.5 八重神子",
					427: "2.6 神里绫人",
                }
            };
            mappings['default'] = mappings['zh-cn'];
        </script>
        <!-- TODO: Refine the CSS -->
        <style>
            a {
                text-decoration: none !important;
            }
            .content {
                width: 400px;
                margin: auto;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .content .navbar {
                margin: auto;
                width: fit-content;
                padding-top: 5px;
                padding-bottom: 30px;
            }

            .yellow {
                color: yellow;
            }

            .blue {
                color: rgb(75, 107, 251);
            }

            .purple {
                color: rgb(242, 40, 242);
            }
        </style>
    </head>
    <body style="background: skyblue;">
        <div class="content">
            <h1>Gacha Records</h1>
            <h2 id="gacha-type"></h2>
            <br/>
            <div style="width: fit-content">
                <table border="1">
                    <tbody id="container">
                        <tr>
                            <th>Time</th>
                            <th>Item</th>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="navbar">
                <a href="" id="prev"> &lt; </a>
                <span id="curpage">1</span>
                <a href="" id="next"> &gt; </a>
            </div>
        </div>

        <script>
            var lang = new window.URLSearchParams(window.location.search).get("lang");
            function itemMapper(itemID) {
                if (mappings[lang] != null && mappings[lang][itemID] != null) {
                    var entry = mappings[lang][itemID];
                    if (entry){
                        return "<span class='" + entry[1] + "'>" + entry[0] + "</span>";
                    }
                } else {
                    if (mappings['default'][itemID] != null) {
                        var entry = mappings['default'][itemID];
                        if (entry){
                            return "<span class='" + entry[1] + "'>" + entry[0] + "</span>";
                        }
                    }
                }
                return "<span class='blue'>" + itemID + "</span>";
            }
            function dateFormatter(timeStamp) {
                var date = new Date(timeStamp);
                if (lang == "en-us" || lang == null) { // MM/DD/YYYY hh:mm:ss.SSS
                    return  String(date.getMonth()+1).padStart(2, "0") + 
                        "/"+String(date.getDate()).padStart(2, "0")+
                        "/"+date.getFullYear()+
                        " "+String(date.getHours()).padStart(2, "0")+
                        ":"+String(date.getMinutes()).padStart(2, "0")+
                        ":"+String(date.getSeconds()).padStart(2, "0")+
                        "."+date.getMilliseconds();
                } else if (lang == "zh-cn") { // YYYY/MM/DD hh:mm:ss.SSS
                    return date.getFullYear()+ 
                        "/" + String(date.getMonth()+1).padStart(2, "0") + 
                        "/"+String(date.getDate()).padStart(2, "0")+
                        " "+String(date.getHours()).padStart(2, "0")+
                        ":"+String(date.getMinutes()).padStart(2, "0")+
                        ":"+String(date.getSeconds()).padStart(2, "0")+
                        "."+date.getMilliseconds();
                }
            }
            (function (){
                var container = document.getElementById("container");
                record.forEach(element => {
                    var e = document.createElement("tr");
                    
                    e.innerHTML= "<td>" + dateFormatter(element.time) + "</td><td>" + itemMapper(element.item) + "</td>";
                    container.appendChild(e);
                });
                // setup pagenation buttons
                var page = parseInt(new window.URLSearchParams(window.location.search).get("p"));
                if (!page){
                    page = 0;
                }
                document.getElementById("curpage").innerText = page + 1;
                var href = new URL(window.location);
                href.searchParams.set("p", page - 1);
                document.getElementById("prev").href = href.toString();
                href.searchParams.set("p", page + 1);
                document.getElementById("next").href = href.toString();

                if (page <= 0) {
                    document.getElementById("prev").style.display = "none";
                }
                if (page >= maxPage - 1) {
                    document.getElementById("next").style.display = "none";
                }

                // setup gacha type info
                var gachaType = new window.URLSearchParams(window.location.search).get("gachaType");
                var gachaString;
                if (mappings[lang] != null && mappings[lang][gachaType] != null) {
                    gachaString = mappings[lang][gachaType];
                }else{
                    gachaString = mappings['default'][gachaType];
                    if (gachaString == null) {
                        gachaString = gachaType;
                    }
                }
                document.getElementById("gacha-type").innerText = gachaString;
        })();
        </script>

    </body>
</html>